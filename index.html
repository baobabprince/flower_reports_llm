<!DOCTYPE html>
<html lang="en" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flower Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
  <link rel="stylesheet" href="./static/css/styles.css">

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster-src.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js" defer></script>

  <script src="./static/js/utils.js" defer></script>
  <script src="./static/js/statistics.js" defer></script>
  <script src="./static/js/FlowerMap.js" defer></script>


  <style>
    /* Basic Map Styles - Adjust as needed */
    #map {
      height: 500px;
      /* Adjust height as needed */
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="card-header">
        <h2>מפת פריחה</h2>
        <div class="date-filter">
          <div class="date-picker-container">
            <button id="datePickerButton" class="button-secondary">בחר תאריך</button>
            <div id="calendar" class="calendar-dropdown hidden"></div>
          </div>
          <button id="clearDates" class="button-secondary">נקה תאריכים</button>
          <span id="selectedDateRange"></span>
        </div>
      </div>
      <div class="tabs">
        <button class="tab-button active" data-tab="map">
          <svg class="tab-icon" width="24" height="24" viewBox="0 0 24 24">
            <path d="M12 20s-4-7-8-10c0-3 6-8 8-8s8 5 8 8c-4 3-8 10-8 10z"></path>
            <circle cx="12" cy="11" r="3"></circle>
          </svg>
          מפה
        </button>
        <button class="tab-button" data-tab="stats">
          <svg class="tab-icon" width="24" height="24" viewBox="0 0 24 24">
            <rect x="3" y="3" width="18" height="18" rx="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="3" x2="9" y2="21"></line>
          </svg>
          סטטיסטיקות
        </button>
        <div class="source-filters">
          <label>
            <input type="checkbox" id="tiuli-filter" checked> טיולי
          </label>
          <label>
            <input type="checkbox" id="merged-filter" checked> מיזוג
          </label>
        </div>
      </div>

      <div id="map-tab" class="tab-content">
        <div id="map"></div>
        <p id="last-update">Loading...</p>
      </div>
      <div id="stats-tab" class="tab-content hidden">
        <div id="stats-container"></div>
        <div id="generalStats"></div>
        <div id="topLocations"></div>
        <div id="recentReports"></div>
        <div id=""></div>
      </div>

    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize the map
      function initializeMap() {
        const mapTilerApiKey = 'YOUR_MAPTILER_API_KEY'; // Replace with your actual API key!

        if (!mapTilerApiKey) {
          console.warn('No API key loaded, map will not function correctly.');
          return; // Don't initialize the map if the API key is missing
        }

        const map = L.map('map').setView([31.7683, 35.2137], 8); // Initial center and zoom

        L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=' + mapTilerApiKey, {
          attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>'
        }).addTo(map);

        // Example Marker (Just to confirm the map is working)
        L.marker([31.7683, 35.2137]).addTo(map)
          .bindPopup('A sample marker!');

        console.log("Leaflet map initialized.");  // Confirm in the console
      }

      initializeMap(); // Call the map initialization function
    });
  </script>
</body>

</html>